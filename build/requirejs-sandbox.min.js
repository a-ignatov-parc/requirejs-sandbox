/**
 * requrejs-sandbox - v0.1.4-116 (build date: 05/08/2013)
 * https://github.com/a-ignatov-parc/requirejs-sandbox
 * Sandbox manager for requre.js to run dedicated apps
 * Copyright (c) 2013 Anton Ignatov
 * Licensed MIT
 */
define("requirejs-sandbox",["requirejs-sandbox/transits","requirejs-sandbox/logger","requirejs-sandbox/utils"],function(a,b,c){var d={},e=/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/,f=function(a){return this.options=c.extend({debug:!1,requireUrl:null,requireMain:null,requireConfig:{}},a),this.iframe=null,this.sandbox=null,this.api={name:this.options.name,require:null,define:null,status:-1,destroy:this.bind(function(){this.sandbox=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null;for(var a in this.api)this.api.hasOwnProperty(a)&&delete this.api[a]},this)},this.createSandbox(function(a){b.debug('Sandbox with name "'+this.options.name+'" is created!',a,a.document.body),this.createLoader(a)}),this.api};return f.prototype={createSandbox:function(a){this.createFrame(null,this.bind(function(b){this.iframe=b,this.sandbox=this.iframe.contentWindow,this.createScript(this.sandbox),"function"==typeof a&&a.call(this,this.sandbox)},this))},createFrame:function(a,c){var d=document.createElement("iframe"),e=function(){return"complete"===document.readyState?(b.debug("DOM is ready. Appending iframe"),document.body.appendChild(d),!0):!1},f=function(){"function"==typeof c&&c(d)};d.style.display="none",d.src=a||"javascript:0",d.tabIndex=-1,d.addEventListener?d.addEventListener("load",f,!1):d.attachEvent?d.attachEvent("onload",f):d.onload=f,e()||(b.debug('DOM isn\'t ready. Subscribing to "onreadystatechange" event'),document.onreadystatechange=function(a){return function(){var b;return"function"==typeof a&&(b=a.apply(this,arguments)),e.apply(this,arguments),b}}(document.onreadystatechange))},createScript:function(a,b,c,d){var e=null,f=!1;if("function"==typeof c&&null==d&&(d=c,c=void 0),a&&a.document&&a.document.body){if(e=a.document.createElement("script"),"object"==typeof c)for(var g in c)c.hasOwnProperty(g)&&null!=c[g]&&e.setAttribute("data-"+g,c[g]);"string"==typeof b&&b&&(e.src=b),"function"==typeof d&&(e.onload=e.onreadystatechange=function(){f||null!=this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(f=!0,e.onload=e.onreadystatechange=null,d(a))}),a.document.body.appendChild(e)}},createLoader:function(a){var c=function(a){this.api.require=a.require,this.api.define=a.define,this.api.status=1,this.options.debug&&(this.api.sandboxManager=this),b.debug("require.js has loaded! Configuring..."),this.api.require.config(this.options.requireConfig),this.createTransitPlugin(a.define),this.createCssPlugin(a.define),b.debug("Executing module callback"),"function"==typeof this.options.callback&&this.options.callback.call(this.api,a.require,a.define)};if(this.options.requireUrl)this.createScript(a,this.options.requireUrl,{main:this.options.requireMain},this.bind(c,this));else{if(this.api.status=0,"function"!=typeof this.options.callback)throw"Unable to alocate require.js. Creating sandbox failed!";this.options.callback.call(this.api)}b.debug("Creating loader inside specified target:",a)},createTransitPlugin:function(c){var d=this.sandbox;b.debug("Creating plugin for loading transits"),c("transit",function(){return{load:function(c,e,f){b.debug("Received module load exec for",c),e([c],function(e){if(a[c])try{a[c].enable(window,d,e)}catch(g){b.error(g)}f(e)})}}})},nameToUrl:function(a,b){b||(b=this.options.requireConfig);var c,d=b.paths,f=location.pathname.split("/"),g=b.baseUrl.split("/");f.pop(),""!==g[0]&&(g=f.concat(g)),g[g.length-1]||g.pop();for(var h in d)if(d.hasOwnProperty(h)&&!a.indexOf(h)){if(a=a.replace(h,"").substr(1),e.test(d[h]))g=[d[h]];else{c=d[h].split("/");for(var i=0,j=c.length;j>i;i++)".."==c[i]?g.pop():g.push(c[i])}break}return a&&g.push(a),g.join("/")},createCssPlugin:function(a){b.debug("Creating plugin for loading css"),a("css",this.bind(function(){return{load:this.bind(function(a,c,d,e){b.debug("Received css load exec for",a);var f=this.nameToUrl(a,e)+".css",g=window.document.createElement("link"),h=window.document.createElement("img");g.rel="stylesheet",g.type="text/css",g.href=f,document.getElementsByTagName("head")[0].appendChild(g),h.onerror=function(){d({cssLink:g})},h.src=f},this)}},this))},bind:function(a,b){return b||(b=window),"function"==typeof a?function(){return a.apply(b,arguments)}:a}},b.setLogLevel("debug"),b.setNamespace("requirejs-sandbox"),{get:function(a){return d[a]},set:function(a,e){var g;return"string"==typeof a&&"object"==typeof e?(g=this.get(a),g&&g.status?(b.warn("Sandbox with name: "+a+" already exist! Returning existed sandbox.",g),g):d[a]=new f(c.extend({},e,{name:a}))):void 0},destroy:function(a){var b=this.get(a);b&&(b.destroy(),delete d[a])}}}),define("requirejs-sandbox/transits",["requirejs-sandbox/transit.jquery"],function(){for(var a={},b=0,c=arguments.length;c>b;b++)null!=arguments[b]&&(a[arguments[b].name]=arguments[b]);return a}),define("requirejs-sandbox/transit.jquery",["requirejs-sandbox/logger"],function(a){return{name:"jquery",enable:function(b,c,d){return"function"!=typeof d?(a.error("This transit require jQuery to be defined!"),void 0):(c.getComputedStyle&&b.getComputedStyle&&(c.getComputedStyle=function(){return b.getComputedStyle.apply(b,arguments)}),d.fn.__patchedInit?(a.debug("jQuery already patched. Skipping..."),void 0):(d.fn.init=function(a,d){return d.__originalInit||(d.__originalInit=a),d.__patchedInit=function(d,e,f){return"string"!=typeof d||e?d==c&&e!=c?new a(b,e,f):d==c.document?new a(b.document,e,f):d==c.document.head?new a(b.document.head,e,f):d==c.document.body?new a(b.document.body,e,f):new a(d,e,f):new a(d,b.document,f)},d.__patchedInit.prototype=d,d.__patchedInit}(d.fn.init,d.fn),void 0))},disable:function(b,c,d){d.fn.__originalInit?(a.debug("Restoring original jQuery instance"),d.fn.init=d.fn.__originalInit,delete d.fn.__originalInit,delete d.fn.__patchedInit):a.warn("jQuery wasn't patched. Skipping...")}}}),define("requirejs-sandbox/utils",function(){var a=Array.prototype,b=Object.prototype,c=b.hasOwnProperty,d=a.forEach,e=a.slice,f={};return{has:function(a,b){return c.call(a,b)},each:function(a,b,c){if(null!=a)if(d&&a.forEach===d)a.forEach(b,c);else if(a.length===+a.length){for(var e=0,g=a.length;g>e;e++)if(b.call(c,a[e],e,a)===f)return}else for(var h in a)if(this.has(a,h)&&b.call(c,a[h],h,a)===f)return},extend:function(a){return this.each(e.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a}}}),define("requirejs-sandbox/logger",function(){var a="logger";return{setLogLevel:function(){},setNamespace:function(b){a=b},debug:function(){},info:function(){},warn:function(){var b=Array.prototype.slice.call(arguments);b.unshift(a),console.warn.apply(this,arguments)},error:function(){var b=Array.prototype.slice.call(arguments);b.unshift(a),console.error.apply(this,arguments)},off:function(){}}});