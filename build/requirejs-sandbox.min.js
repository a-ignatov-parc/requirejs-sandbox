/**
 * requrejs-sandbox - v0.1.5-19 (build date: 27/08/2013)
 * https://github.com/a-ignatov-parc/requirejs-sandbox
 * Sandbox manager for requre.js to run dedicated apps
 * Copyright (c) 2013 Anton Ignatov
 * Licensed MIT
 */
define("requirejs-sandbox",["requirejs-sandbox/logger","requirejs-sandbox/utils","requirejs-sandbox/plugins/css","requirejs-sandbox/plugins/transit"],function(a,b,c,d){var e={},f=function(c){return this.options=b.extend({debug:!1,requireUrl:null,requireMain:null,requireConfig:{},sandboxExport:{}},c),this.iframe=null,this.sandbox=null,this.api={name:this.options.name,require:null,define:null,status:-1,destroy:b.bind(function(){this.sandbox=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null;for(var a in this.api)this.api.hasOwnProperty(a)&&delete this.api[a]},this)},this.createSandbox(function(b){a.debug('Sandbox with name "'+this.options.name+'" is created!',b,b.document.body);for(var c in this.options.sandboxExport)this.options.sandboxExport.hasOwnProperty(c)&&(b[c]=this.options.sandboxExport[c]);this.createLoader(b)}),this.api};return f.prototype={createSandbox:function(a){this.createFrame(null,b.bind(function(b){this.iframe=b,this.sandbox=this.iframe.contentWindow,this.createScript(this.sandbox),"function"==typeof a&&a.call(this,this.sandbox)},this))},createFrame:function(b,c){var d=document.createElement("iframe"),e=function(){return"complete"===document.readyState?(a.debug("DOM is ready. Appending iframe"),document.body.appendChild(d),!0):!1},f=function(){"function"==typeof c&&c(d)};d.style.display="none",d.src=b||"javascript:0",d.tabIndex=-1,d.addEventListener?d.addEventListener("load",f,!1):d.attachEvent?d.attachEvent("onload",f):d.onload=f,e()||(a.debug('DOM isn\'t ready. Subscribing to "onreadystatechange" event'),document.onreadystatechange=function(a){return function(){var b;return"function"==typeof a&&(b=a.apply(this,arguments)),e.apply(this,arguments),b}}(document.onreadystatechange))},createScript:function(a,b,c,d){var e=null,f=!1;if("function"==typeof c&&null==d&&(d=c,c=void 0),a&&a.document&&a.document.body){if(e=a.document.createElement("script"),"object"==typeof c)for(var g in c)c.hasOwnProperty(g)&&null!=c[g]&&e.setAttribute("data-"+g,c[g]);"string"==typeof b&&b&&(e.src=b),"function"==typeof d&&(e.onload=e.onreadystatechange=function(){f||null!=this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(f=!0,e.onload=e.onreadystatechange=null,d(a))}),a.document.getElementsByTagName("head")[0].appendChild(e)}},createLoader:function(e){var f=function(b){this.api.require=b.require,this.api.define=b.define,this.api.status=1,this.options.debug&&(this.api.sandboxManager=this),a.debug("require.js has loaded! Configuring..."),this.api.require.config(this.options.requireConfig),c.create(b.define),d.create(b.define,this.sandbox),a.debug("Executing module callback"),"function"==typeof this.options.callback&&this.options.callback.call(this.api,b.require,b.define)};if(this.options.requireUrl)this.createScript(e,this.options.requireUrl,{main:this.options.requireMain},b.bind(f,this));else{if(this.api.status=0,"function"!=typeof this.options.callback)throw"Unable to alocate require.js. Creating sandbox failed!";this.options.callback.call(this.api)}a.debug("Creating loader inside specified target:",e)}},a.setLogLevel("debug"),a.setNamespace("requirejs-sandbox"),{get:function(a){return e[a]},set:function(c,d){var g;return"string"==typeof c&&"object"==typeof d?(g=this.get(c),g&&g.status?(a.warn("Sandbox with name: "+c+" already exist! Returning existed sandbox.",g),g):e[c]=new f(b.extend({},d,{name:c}))):void 0},destroy:function(a){var b=this.get(a);b&&(b.destroy(),delete e[a])}}}),define("requirejs-sandbox/transits",["requirejs-sandbox/transit.jquery"],function(){for(var a={},b=0,c=arguments.length;c>b;b++)null!=arguments[b]&&(a[arguments[b].name]=arguments[b]);return a}),define("requirejs-sandbox/transit.jquery",["requirejs-sandbox/logger"],function(a){return{name:"jquery",enable:function(b,c,d){return"function"!=typeof d?(a.error("This transit require jQuery to be defined!"),void 0):(c.getComputedStyle&&b.getComputedStyle&&(c.getComputedStyle=function(){return b.getComputedStyle.apply(b,arguments)}),d.fn.__patchedInit?(a.debug("jQuery already patched. Skipping..."),void 0):(d.fn.init=function(a,d){return d.__originalInit||(d.__originalInit=a),d.__patchedInit=function(d,e,f){return"string"!=typeof d||e?d==c&&e!=c?new a(b,e,f):d==c.document?new a(b.document,e,f):d==c.document.head?new a(b.document.head,e,f):d==c.document.body?new a(b.document.body,e,f):new a(d,e,f):new a(d,b.document,f)},d.__patchedInit.prototype=d,d.__patchedInit}(d.fn.init,d.fn),void 0))},disable:function(b,c,d){d.fn.__originalInit?(a.debug("Restoring original jQuery instance"),d.fn.init=d.fn.__originalInit,delete d.fn.__originalInit,delete d.fn.__patchedInit):a.warn("jQuery wasn't patched. Skipping...")}}}),define("requirejs-sandbox/utils",function(){var a=Array.prototype,b=Object.prototype,c=b.hasOwnProperty,d=a.forEach,e=a.slice,f={};return{has:function(a,b){return c.call(a,b)},each:function(a,b,c){if(null!=a)if(d&&a.forEach===d)a.forEach(b,c);else if(a.length===+a.length){for(var e=0,g=a.length;g>e;e++)if(b.call(c,a[e],e,a)===f)return}else for(var h in a)if(this.has(a,h)&&b.call(c,a[h],h,a)===f)return},extend:function(a){return this.each(e.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},bind:function(a,b){return b||(b=window),"function"==typeof a?function(){return a.apply(b,arguments)}:a}}}),define("requirejs-sandbox/plugins/css",["requirejs-sandbox/utils"],function(a){return{create:function(b){console.debug("Creating plugin for loading css"),b("css",a.bind(function(){return{load:a.bind(function(a,b,c){console.debug("Received css load exec for",a);var d=b.toUrl(a+".css"),e=window.document.createElement("link"),f=window.document.createElement("img");e.rel="stylesheet",e.type="text/css",e.href=d,document.getElementsByTagName("head")[0].appendChild(e),f.onerror=function(){c({cssLink:e})},f.src=d},this)}},this))}}}),define("requirejs-sandbox/plugins/transit",["requirejs-sandbox/transits"],function(a){return{create:function(b,c){console.debug("Creating plugin for loading transits"),b("transit",function(){return{load:function(b,d,e){console.debug("Received module load exec for",b),d([b],function(d){if(a[b])try{a[b].enable(window,c,d)}catch(f){console.error(f)}e(d)})}}})}}}),define("requirejs-sandbox/logger",function(){var a="logger";return{setLogLevel:function(){},setNamespace:function(b){a=b},debug:function(){},info:function(){},warn:function(){var b=Array.prototype.slice.call(arguments);b.unshift(a),console.warn.apply(this,arguments)},error:function(){var b=Array.prototype.slice.call(arguments);b.unshift(a),console.error.apply(this,arguments)},off:function(){}}});