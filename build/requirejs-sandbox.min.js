/**
 * requirejs-sandbox - v0.6.0-12 (build date: 13/07/2014)
 * https://github.com/a-ignatov-parc/requirejs-sandbox
 * Sandbox manager for require.js allows user to run multiple apps without scope intersection issues
 * Copyright (c) 2014 Anton Ignatov
 * Licensed MIT
 */
!function(e,t){"function"==typeof define&&define.amd?define("requirejs-sandbox",[],t):(e.requirejsSandbox||(e.requirejsSandbox={}),e.requirejsSandbox.manager=t())}(this,function(){var e,t,n;return function(r){function i(e,t){return x.call(e,t)}function s(e,t){var n,r,i,s,o,a,u,c,l,d,h,f=t&&t.split("/"),p=m.map,g=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(f=f.slice(0,f.length-1),e=e.split("/"),o=e.length-1,m.nodeIdCompat&&_.test(e[o])&&(e[o]=e[o].replace(_,"")),e=f.concat(e),l=0;l<e.length;l+=1)if(h=e[l],"."===h)e.splice(l,1),l-=1;else if(".."===h){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||g)&&p){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),f)for(d=f.length;d>0;d-=1)if(i=p[f.slice(0,d).join("/")],i&&(i=i[r])){s=i,a=l;break}if(s)break;!u&&g&&g[r]&&(u=g[r],c=l)}!s&&u&&(s=u,a=c),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function o(e,t){return function(){return f.apply(r,w.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return s(t,e)}}function u(e){return function(t){v[e]=t}}function c(e){if(i(b,e)){var t=b[e];delete b[e],y[e]=!0,h.apply(r,t)}if(!i(v,e)&&!i(y,e))throw new Error("No "+e);return v[e]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return m&&m.config&&m.config[e]||{}}}var h,f,p,g,v={},b={},m={},y={},x=Object.prototype.hasOwnProperty,w=[].slice,_=/\.js$/;p=function(e,t){var n,r=l(e),i=r[0];return e=r[1],i&&(i=s(i,t),n=c(i)),i?e=n&&n.normalize?n.normalize(e,a(t)):s(e,t):(e=s(e,t),r=l(e),i=r[0],e=r[1],i&&(n=c(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},g={require:function(e){return o(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:d(e)}}},h=function(e,t,n,s){var a,l,d,h,f,m,x=[],w=typeof n;if(s=s||e,"undefined"===w||"function"===w){for(t=!t.length&&n.length?["require","exports","module"]:t,f=0;f<t.length;f+=1)if(h=p(t[f],s),l=h.f,"require"===l)x[f]=g.require(e);else if("exports"===l)x[f]=g.exports(e),m=!0;else if("module"===l)a=x[f]=g.module(e);else if(i(v,l)||i(b,l)||i(y,l))x[f]=c(l);else{if(!h.p)throw new Error(e+" missing "+l);h.p.load(h.n,o(s,!0),u(l),{}),x[f]=v[l]}d=n?n.apply(v[e],x):void 0,e&&(a&&a.exports!==r&&a.exports!==v[e]?v[e]=a.exports:d===r&&m||(v[e]=d))}else e&&(v[e]=n)},e=t=f=function(e,t,n,i,s){if("string"==typeof e)return g[e]?g[e](t):c(p(e,t).f);if(!e.splice){if(m=e,m.deps&&f(m.deps,m.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=i,i=s),i?h(r,e,t,n):setTimeout(function(){h(r,e,t,n)},4),f},f.config=function(e){return f(e)},e._defined=v,n=function(e,t,n){t.splice||(n=t,t=[]),i(v,e)||i(b,e)||(b[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../bower_components/almond/almond",function(){}),n("console",[],function(){var e="logger";return{setLogLevel:function(){},setNamespace:function(t){e=t},log:function(){},debug:function(){},info:function(){},warn:function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),console.warn.apply(this,arguments)},error:function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),console.error.apply(this,arguments)},off:function(){}}}),n("helpers/utils",[],function(){var e=Array.prototype,t=Object.prototype,n=t.hasOwnProperty,r=e.forEach,i=e.slice,s={},o=document.createElement("a");return{has:function(e,t){return n.call(e,t)},each:function(e,t,n){if(null!=e)if(r&&e.forEach===r)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(t.call(n,e[i],i,e)===s)return}else for(var a in e)if(this.has(e,a)&&t.call(n,e[a],a,e)===s)return},extend:function(e){return this.each(i.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},bind:function(e,t){return t||(t=window),"function"==typeof e?function(){return e.apply(t,arguments)}:e},defaults:function(e){return this.each(i.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},scripts:function(){return Array.prototype.slice.call(document.getElementsByTagName("script"),0)},urlToLocation:function(e){return o.href=e,{href:o.href,host:o.host,port:o.port,hash:o.hash,origin:o.origin,search:o.search,protocol:o.protocol,hostname:o.hostname,pathname:o.pathname}}}}),n("helpers/resolvers/abstract",["console","helpers/utils"],function(e,t){var n={STATE_IDLE:"idle",STATE_RESOLVING:"resolving",STATE_RESOLVED:"resolved",_state:null,_resolvedUrl:!1,_onSuccess:function(){e.warn("No success handler defined for "+this.id+" resolver! Use _setHandlers() method to do this.")},_onFail:function(){e.warn("No fail handler defined for "+this.id+" resolver! Use _setHandlers() method to do this.")},_setHandlers:function(e,t){"function"==typeof e&&(this._onSuccess=e),"function"==typeof t&&(this._onFail=t)},_hanldleResolver:function(){switch(this.state()){case this.STATE_RESOLVED:return e.debug(this.id+" resolver: resolved",this._resolvedUrl),this._onSuccess(this._resolvedUrl),this._resolvedUrl;case this.STATE_IDLE:return e.debug(this.id+" resolver: failed to resolve"),void this._onFail();default:return}},_getScripts:function(){return t.scripts()},state:function(){return this._state},resolve:function(){e.error("Not implemented!")},reset:function(){return this._state=this.STATE_IDLE,this}};return n.reset()}),n("helpers/resolvers/optionsResolver",["console","helpers/utils","helpers/resolvers/abstract"],function(e,t,n){return t.defaults({id:"options",resolve:function(t,n,r){return this.state()==this.STATE_IDLE&&(this._setHandlers(t,n),e.debug(this.id+" resolver: starting resolving"),r&&"string"==typeof r.requireUrl&&(this._resolvedUrl=r.requireUrl,this._state=this.STATE_RESOLVED)),this._hanldleResolver()}},n)}),n("helpers/resolvers/scriptResolver",["console","helpers/utils","helpers/resolvers/abstract"],function(e,t,n){var r=/require(?:[.-]min)?.js$/;return t.defaults({id:"script",_checkUrl:function(e){return r.test(e)},resolve:function(n,r){return this.state()==this.STATE_IDLE&&(this._setHandlers(n,r),e.debug(this.id+" resolver: starting resolving"),t.each(this._getScripts(),t.bind(function(e){return this._checkUrl(e.getAttribute("src"))?(this._resolvedUrl=e.getAttribute("src"),this._state=this.STATE_RESOLVED,!0):void 0},this))),this._hanldleResolver()}},n)}),n("helpers/resolvers/iframeResolver",["console","helpers/utils","sandbox-manager","helpers/resolvers/abstract"],function(e,t,n,r){function i(e,t,n,r){e.length?n(t,e.shift().getAttribute("src"),function(s){"function"==typeof t.require&&"function"==typeof t.requirejs&&"function"==typeof t.define?r(s.getAttribute("src")):i(e,t,n,r)},function(){i(e,t,n,r)}):r(!1)}var s;return t.defaults({id:"iframe",resolve:function(r,o){var a;if(this.state()==this.STATE_IDLE)this._setHandlers(r,o),a=this._getScripts(),e.debug(this.id+" resolver: starting resolving"),a.length&&(this._state=this.STATE_RESOLVING,s||(s=n._getSandboxInternalInterface()),s.createFrame(null,t.bind(function(e){var n=e.contentWindow;n.onerror=function(){},i(a,n,s.createScript,t.bind(function(t){t?(this._resolvedUrl=t,this._state=this.STATE_RESOLVED):this._state=this.STATE_IDLE,e.parentNode.removeChild(e),e=n=a=null,this._hanldleResolver()},this))},this)));else if(this.state()==this.STATE_RESOLVED)return this._resolvedUrl}},r)}),n("helpers/resolvers/cdnResolver",["console","helpers/utils","helpers/resolvers/abstract"],function(e,t,n){return t.defaults({id:"cdn",_resolvedUrl:"//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.9/require.min.js",resolve:function(t){return this.state()==this.STATE_IDLE&&(this._setHandlers(t),e.debug(this.id+" resolver: starting resolving"),this._state=this.STATE_RESOLVED),this._hanldleResolver()}},n)}),n("helpers/require",["console","helpers/utils","helpers/resolvers/optionsResolver","helpers/resolvers/scriptResolver","helpers/resolvers/iframeResolver","helpers/resolvers/cdnResolver"],function(e,t,n,r,i,s){function o(e){t.each(d,function(t){"function"==typeof t[0]?t[0](e):a("No fail handler",t[1]||!1)}),h=!1,d.length=c=0}function a(e,n){if(null!=n){if("function"!=typeof n)throw e;n(e)}else t.each(d,function(t){a(e,t[1]||!1)}),h=!1,d.length=c=0}var u=!1,c=0,l=[n,r,i,s],d=[],h=!1;return{id:"main",resolved:function(){return!!u},reset:function(){u=!1,t.each(l,function(e){e.reset()})},resolve:function(){var t,n=this;if(arguments.length)d.push(t=arguments);else{if(!d.length)return void e.error("No handlers passed");t=d[0]}if(!h||!arguments.length)return h=!0,this.resolved()?(e.debug(this.id+" resolver: already resolved as",u),o(u),u):void(null!=l[c]?(e.debug(this.id+' resolver: starting "'+l[c].id+'" resolver'),l[c].resolve(function(e){o(u=e)},function(){c++,n.resolve()},t[2])):(e.debug(this.id+" resolver: all resolvers failed"),a("Unable to resolve require.js source url")))}}}),n("helpers/preprocess/abstract",["console"],function(e){return{Processor:null,loadHandler:function(t,n){var r=this.Processor;return function(){switch(this.status){case 0:case 200:case 302:e.debug("File received correctly",t),n(new r(!0,this.response));break;case 404:e.debug("File was not found",t),n(new r(3));break;default:e.debug("Received unhandled status",t,this.status),n(new r(4))}}},errorHandler:function(t,n){var r=this.Processor;return function(){e.debug("Something goes wrong",t,this.status),n(new r(5))}},checkXMLHttpRequestSupport:function(){return"function"==typeof XMLHttpRequest||"object"==typeof XMLHttpRequest},createAjaxLoader:function(e,t,n,r){var i=new XMLHttpRequest;return i.open("GET",t.toUrl(e)+(r||".js"),!0),i.onload=this.loadHandler(e,n),i.onerror=this.errorHandler(e,n),{load:function(){i.send()}}},createDefaultLoader:function(e,t,n){var r=this.Processor;return{load:function(){t([e],function(){n(new r(2))})}}}}}),n("helpers/processor/core",["console","helpers/utils"],function(e,t){var n=[],r=/^\s*define\((['"][^'"]+['"])?,?\s*(?:\[([^\]]+)\])?,?\s*(function[^]+)\);*\s*$/,i=/['"]*\s*/g;return function(s){var o=s||window,a=function(t,n){return this.id=this._responseSourceCache.push(n||"")-1,this.target=o,"boolean"!=typeof t&&1!==t&&0!==t&&"1"!==t&&"0"!==t?(e.debug("Creating simple response with status: "+t),{id:this.id,status:t||6}):(this.status="boolean"==typeof t?+!t:+t,void e.debug("Creating extended resource api with status: "+this.status))};return a.extend=function(){for(var e=0,n=arguments.length;n>e;e++)t.extend(a.prototype,arguments[e])},a.prototype={_responseSourceCache:n,replace:function(t,n){return e.debug('[replace] Executing replace with pattern: "'+t+'" and replace: "'+n+'"'),this._responseSourceCache[this.id]=this._responseSourceCache[this.id].replace(t,n),e.debug("[replace] Executing result: "+this._responseSourceCache[this.id]),this},resolve:function(t){var n,s,a,u,c,l=this._responseSourceCache[this.id],d=r.exec(l);if(e.debug("Execution context",o),d){d[1]&&(u=d[1].replace(i,"")),c=d[2]?d[2].replace(i,"").split(","):[],e.debug('module name: "'+u+'"'),e.debug("module deps: ["+c.join(", ")+"]"),e.debug('module handler: "'+d[3]+'"'),a=new o.Function("return "+d[3]);try{s=a()}catch(h){e.error(h)}if(u)o.define(u,c,function(){try{n=s.apply(this,arguments)}catch(t){e.error(t)}return n}),o.require([u],function(e){"function"==typeof t&&t(e)});else if(c.length)o.require(c,function(){try{n=s.apply(this,arguments)}catch(r){e.error(r)}"function"==typeof t&&t(n)});else{try{n=s()}catch(h){e.error(h)}"function"==typeof t&&t(n)}}else{var f=o.document.createElement("script");f.type="text/javascript",f.text=l,o.document.getElementsByTagName("head")[0].appendChild(f),"function"==typeof t&&t()}return this}},a}}),n("helpers/processor/autofix",["console"],function(e){return{autoFix:function(t){for(var n=["location","document"].concat(t||[]),r={},i=0,s=n.length;s>i;i++){var o=n[i].split(".").pop(),a="__window_"+o.toLowerCase();r[n[i]]||(r[n[i]]=!0,this.target[a]=this.target.sandboxApi&&this.target.sandboxApi.parentWindow[o]||this.target[o],this._responseSourceCache[this.id]=this._responseSourceCache[this.id].replace(new RegExp("(\\W)"+o+"(\\W)","g"),"$1"+a+"$2"))}return e.debug("[autoFix] Executing result: "+this._responseSourceCache[this.id]),this}}}),n("helpers/preprocess/plugin",["console","helpers/utils","helpers/preprocess/abstract","helpers/processor/core","helpers/processor/autofix"],function(e,t,n,r,i){return e.debug("Creating plugin for loading and preprocessing resources"),function(s){var o=new r(s),a=t.extend({},n,{Processor:o});return o.extend(i),{name:"preprocess",handler:function(){return{load:function(t,n,r){var i;e.debug("Received resource load exec for",t),i=a.checkXMLHttpRequestSupport()?a.createAjaxLoader(t,n,r):a.createDefaultLoader(t,n,r),i.load()}}}}}}),n("sandbox-manager",["console","helpers/utils","helpers/require","helpers/preprocess/plugin"],function(e,t,n,r){var i={},s=function(r){return this.options=t.defaults(r,{debug:!1,requireUrl:null,requireMain:null,requireConfig:{},sandboxLinks:{},patch:[],plugins:[],success:function(){},error:function(){}}),this.iframe=null,this.sandbox=null,this.requireUrl=null,this.api={name:this.options.name,require:null,define:null,status:-1,destroy:t.bind(function(){this.sandbox=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null;for(var e in this.api)this.api.hasOwnProperty(e)&&delete this.api[e]},this)},this.createSandbox(function(r){e.debug('Sandbox with name "'+this.options.name+'" is created!',r,r.document.body);for(var i in this.options.sandboxLinks)this.options.sandboxLinks.hasOwnProperty(i)&&(r[i]=this.options.sandboxLinks[i]);this.sandbox.sandboxApi=t.extend({},this.api,{parentWindow:window}),n.resolve(t.bind(function(e){this.requireUrl=e,this.createLoader(r)},this),t.bind(function(t){this.api.status=this.sandbox.sandboxApi.status=1,this.options.error.call(this.api),e.error(t)},this),this.options)}),this.api};return s.prototype={createSandbox:function(e){this.createFrame(null,t.bind(function(t){this.iframe=t,this.sandbox=this.iframe.contentWindow,this.createScript(this.sandbox),"function"==typeof e&&e.call(this,this.sandbox)},this))},createFrame:function(t,n){var r=document.createElement("iframe"),i=function(){return"complete"===document.readyState?(e.debug("DOM is ready. Appending iframe"),document.body.appendChild(r),!0):!1},s=function(){"function"==typeof n&&n(r)};r.style.display="none",r.src=t||"javascript:0",r.tabIndex=-1,r.addEventListener?r.addEventListener("load",s,!1):r.attachEvent?r.attachEvent("onload",s):r.onload=s,i()||(e.debug('DOM isn\'t ready. Subscribing to "onreadystatechange" event'),document.onreadystatechange=function(e){return function(){var t;return"function"==typeof e&&(t=e.apply(this,arguments)),i.apply(this,arguments),t}}(document.onreadystatechange))},createScript:function(e,t,n,r,i){var s,o,a=null,u=!1;if("function"==typeof n?(o=r,s=n,n=void 0):(s=r,o=i),e&&e.document&&e.document.body){if(a=e.document.createElement("script"),"object"==typeof n)for(var c in n)n.hasOwnProperty(c)&&null!=n[c]&&a.setAttribute("data-"+c,n[c]);switch(typeof t){case"string":if(t)a.src=t;else if("function"==typeof o)return void o(!1,e);break;case"object":case"undefined":return void("function"==typeof o&&o(!1,e))}"function"==typeof s&&(a.onload=a.onerror=a.onreadystatechange=function(t){u||(u=!0,a.onload=a.onerror=a.onreadystatechange=null,"load"===t.type||"loaded"===this.readyState||"complete"===this.readyState?s(a,e):"function"!=typeof o||"error"!==t.type&&"error"!==this.readyState||o(a,e))}),e.document.getElementsByTagName("head")[0].appendChild(a)}},createLoader:function(i){var s=function(i,s){var o,a=this.options.patch,u=function(t,n){n.enable(window,s,t),e.debug('Patch for module "'+n.name+'" applied correctly')},c=t.bind(function(){e.debug("Executing module callback"),this.options.success.call(this.api,this.api.require,this.api.define)},this),l=function(t){for(var n=0,r=a.length;r>n;n++)if("string"==typeof a[n]&&t.name===a[n]){a[n]=t,e.debug('Patch "'+t.name+'" is resolved.');break}--d||c()},d=0;if(this.api.require=this.sandbox.sandboxApi.require=s.require,this.api.define=this.sandbox.sandboxApi.define=s.define,this.api.status=this.sandbox.sandboxApi.status=0,this.options.debug&&(this.api.sandboxManager=this),"function"!=typeof this.api.require||"function"!=typeof this.api.define)return n.reset(),this.api.status=this.sandbox.sandboxApi.status=2,this.options.error.call(this.api),void e.error("Can not gain access to require.js inside sandbox");this.api.require.config(this.options.requireConfig);for(var h=0,f=this.options.plugins.length;f>h;h++){var p=this.options.plugins[h],g=""+p.name,v=!1;g||(e.error("Registered plugin has no name"),v=!0),"function"!=typeof p.handler&&(e.error("Registered plugin handler is not a function"),v=!0),e.debug("Successfuly registered plugin with name: "+g),v||this.api.define(g,p.handler)}for(e.debug("Creating predefined modules"),this.api.define("sandbox",function(){return s}),e.debug('Creating "preprocess" plugin for sandbox require.js'),o=new r(s),this.api.define(o.name,o.handler),e.debug("Creating handler for amd modules load"),this.api.require.onResourceLoad=function(e,t){for(var n,r=e.defined[t.id],i=t.name,o=0,c=a.length;c>o;o++)n=a[o],n.name==i&&u(r||s[n.shimName],a[o])},e.debug("Checking for unresolved patches"),h=0,f=a.length;f>h;h++)if("string"==typeof a[h]){var b=a[h],m=["requirejs-sandbox","patches",b].join("/");window.require&&"function"==typeof window.require.defined?window.require.defined(m)?(e.debug('Patch "'+m+'" is resolved in parent page. Linking with patch list...'),a[h]=window.require(m)):(d++,e.debug('Patch "'+m+'" is unresolved. Resolving...'),window.require([m],l)):window.requirejsSandbox&&window.requirejsSandbox.patches&&window.requirejsSandbox.patches[b]&&(a[h]=window.requirejsSandbox.patches[b])}d||c()};this.createScript(i,this.requireUrl,{main:this.options.requireMain},t.bind(s,this),t.bind(function(){n.reset(),this.api.status=this.sandbox.sandboxApi.status=3,this.options.error.call(this.api),e.error("Can not load require.js into sandbox")},this)),e.debug("Creating loader inside specified target:",i)}},e.setLogLevel("debug"),e.setNamespace("requirejs-sandbox"),{_getSandboxInternalInterface:function(){return s.prototype},get:function(e){return i[e]},set:function(n,r){var o;return"string"==typeof n?(o=this.get(n),o&&o.status<=0?(e.warn("Sandbox with name: "+n+" already exist! Returning existed sandbox.",o),o):i[n]=new s(t.extend({},r,{name:n}))):void e.error("Sandbox name should be string")},destroy:function(t){var n=this.get(t);n?(n.destroy(),delete i[t]):e.warn('Sandbox with name: "'+t+'" was not found')}}}),t("sandbox-manager")});