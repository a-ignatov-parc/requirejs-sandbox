/**
 * requrejs-sandbox - v0.1.1 (build date: 19/07/2013)
 * https://github.com/a-ignatov-parc/requirejs-sandbox
 * Module for requre.js to create sandbox enviroment to run dedicated apps
 * Copyright (c) 2013 Anton Ignatov
 * Licensed MIT
 */
define("requirejs-sandbox",["transits","underscore"],function(a,b){var c={},d=function(a){return this.options=b.extend({requireUrl:null,requireConfig:{},useLocationFix:!1},a),this.iframe=null,this.sandbox=null,this.api={name:this.options.name,require:null,destroy:this.bind(function(){this.sandbox=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null},this)},this.createSandbox(function(a){console.log("Sandbox created!",a,a.document.body),this.createLoader(a)}),this.api};return d.prototype={createSandbox:function(a){var b=this.bind(function(){this.sandbox=this.iframe.contentWindow,this.createScript(this.sandbox),"function"==typeof a&&a.call(this,this.sandbox)},this);if(this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.options.useLocationFix?(this.iframe.src=this.options.hosts.html+"sandbox.html",console.warn("Using location fix hack for "+this.appName+"! No crossdomain initialization available")):this.iframe.src="javascript:0",this.iframe.tabIndex=-1,this.iframe.addEventListener?this.iframe.addEventListener("load",b,!1):this.iframe.attachEvent?this.iframe.attachEvent("onload",b):this.iframe.onload=b,"complete"!==document.readyState)throw"Can't determine DOMReady state!";document.body.appendChild(this.iframe)},createScript:function(a,b,c){var d=null,e=!1;a&&a.document&&a.document.body&&(d=a.document.createElement("script"),"string"==typeof b&&b&&(d.src=b),"function"==typeof c&&(d.onload=d.onreadystatechange=function(){e||null!=this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e=!0,d.onload=d.onreadystatechange=null,c(a))}),a.document.body.appendChild(d))},createLoader:function(a){var b=function(a){this.api.require=a.require,console.log("require.js has loaded! Configuring..."),this.api.require.config(this.options.requireConfig),this.createTransitPlugin(a.define),console.log("Executing module callback"),"function"==typeof this.options.callback&&this.options.callback(a.require)};if(!this.options.requireUrl)throw"Unable to create loader";this.createScript(a,this.options.requireUrl,this.bind(b,this)),console.log("Creating loader inside specified target:",a)},createTransitPlugin:function(b){var c=this.sandbox;console.log("Creating plugin for loading transits"),b("transit",function(){return{load:function(b,d,e){console.log("Received module load exec for",b),d([b],function(d){if(e(d),a[b])try{a[b].enable(window,c,d)}catch(f){console.error(f)}})}}})},bind:function(a,b){return b||(b=window),"function"==typeof a?function(){return a.apply(b,arguments)}:a}},{get:function(a){return c[a]?c[a]:void 0},set:function(a,e){var f;return"string"==typeof a&&"object"==typeof e?(f=this.get(a))?(console.warn("Sandbox with name: "+a+" already exist! Returning existed sandbox.",f),f):c[a]=new d(b.extend({},e,{name:a})):void 0},destroy:function(a){var b=this.get(a);b&&b.destroy()}}}),define("transits",["transit.jquery"],function(){for(var a={},b=0,c=arguments.length;c>b;b++)null!=arguments[b]&&(a[arguments[b].name]=arguments[b]);return a}),define("transit.jquery",function(){return{name:"jquery",enable:function(a,b,c){return"function"!=typeof c?(console.error("This transit require jQuery to be defined!"),void 0):(b.getComputedStyle&&a.getComputedStyle&&(b.getComputedStyle=function(){return a.getComputedStyle.apply(a,arguments)}),c.fn.init=function(c,d){var e=function(d,e,f){return"string"!=typeof d||e?d==b&&e!=b?new c(a,e,f):d==b.document?new c(a.document,e,f):d==b.document.head?new c(a.document.head,e,f):d==b.document.body?new c(a.document.body,e,f):new c(d,e,f):new c(d,a.document,f)};return e.prototype=d,e}(c.fn.init,c.fn),void 0)},disable:function(){console.warn("This transit can not be disabled")}}});