/**
 * requirejs-sandbox - v0.4.2-68 (build date: 18/04/2014)
 * https://github.com/a-ignatov-parc/requirejs-sandbox
 * Sandbox manager for require.js allows user to run multiple apps without scope intersection issues
 * Copyright (c) 2014 Anton Ignatov
 * Licensed MIT
 */
define("requirejs-sandbox/logger/logger",function(){var e="logger";return{setLogLevel:function(){},setNamespace:function(t){e=t},log:function(){},debug:function(){},info:function(){},warn:function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),console.warn.apply(this,arguments)},error:function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),console.error.apply(this,arguments)},off:function(){}}}),define("requirejs-sandbox/helpers/utils",function(){var e=Array.prototype,t=Object.prototype,r=t.hasOwnProperty,n=e.forEach,i=e.slice,s={};return{has:function(e,t){return r.call(e,t)},each:function(e,t,r){if(null!=e)if(n&&e.forEach===n)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(t.call(r,e[i],i,e)===s)return}else for(var a in e)if(this.has(e,a)&&t.call(r,e[a],a,e)===s)return},extend:function(e){return this.each(i.call(arguments,1),function(t){if(t)for(var r in t)e[r]=t[r]}),e},bind:function(e,t){return t||(t=window),"function"==typeof e?function(){return e.apply(t,arguments)}:e},defaults:function(e){return this.each(i.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e},scripts:function(){return Array.prototype.slice.call(document.getElementsByTagName("script"),0)}}}),define("requirejs-sandbox/helpers/patch",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils"],function(e,t){var r={_options:{},name:"default",shimName:"default",enable:function(){e.warn("Method is not implemented")},disable:function(){e.warn("Method is not implemented")},setOptions:function(e){var r=function(e){this._options=t.extend({},this._options,e)};return r.prototype=this,new r(e)}};return{init:function(e){return t.defaults(e||{},r)}}}),define("requirejs-sandbox/helpers/resolvers/abstract",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils"],function(e,t){var r={STATE_IDLE:"idle",STATE_RESOLVING:"resolving",STATE_RESOLVED:"resolved",_state:null,_resolvedUrl:!1,_onSuccess:function(){e.warn("No success handler defined for "+this.id+" resolver! Use _setHandlers() method to do this.")},_onFail:function(){e.warn("No fail handler defined for "+this.id+" resolver! Use _setHandlers() method to do this.")},_setHandlers:function(e,t){"function"==typeof e&&(this._onSuccess=e),"function"==typeof t&&(this._onFail=t)},_hanldleResolver:function(){switch(this.state()){case this.STATE_RESOLVED:return e.debug(this.id+" resolver: resolved",this._resolvedUrl),this._onSuccess(this._resolvedUrl),this._resolvedUrl;case this.STATE_IDLE:return e.debug(this.id+" resolver: failed to resolve"),void this._onFail();default:return}},_getScripts:function(){return t.scripts()},state:function(){return this._state},resolve:function(){e.error("Not implemented!")},reset:function(){return this._state=this.STATE_IDLE,this}};return r.reset()}),define("requirejs-sandbox/helpers/resolvers/optionsResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,t,r){return t.defaults({id:"options",resolve:function(t,r,n){return this.state()==this.STATE_IDLE&&(this._setHandlers(t,r),e.debug(this.id+" resolver: starting resolving"),n&&"string"==typeof n.requireUrl&&(this._resolvedUrl=n.requireUrl,this._state=this.STATE_RESOLVED)),this._hanldleResolver()}},r)}),define("requirejs-sandbox/helpers/resolvers/scriptResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,t,r){var n=/require(?:[.-]min)?.js$/;return t.defaults({id:"script",_checkUrl:function(e){return n.test(e)},resolve:function(r,n){return this.state()==this.STATE_IDLE&&(this._setHandlers(r,n),e.debug(this.id+" resolver: starting resolving"),t.each(this._getScripts(),t.bind(function(e){return this._checkUrl(e.getAttribute("src"))?(this._resolvedUrl=e.getAttribute("src"),this._state=this.STATE_RESOLVED,!0):void 0},this))),this._hanldleResolver()}},r)}),define("requirejs-sandbox/helpers/resolvers/iframeResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,t,r){function n(e,t,r,i){e.length?r(t,e.shift().getAttribute("src"),function(s){"function"==typeof t.require&&"function"==typeof t.requirejs&&"function"==typeof t.define?i(s.getAttribute("src")):n(e,t,r,i)},function(){n(e,t,r,i)}):i(!1)}var i;return t.defaults({id:"iframe",resolve:function(r,s){var o;if(this.state()==this.STATE_IDLE)this._setHandlers(r,s),o=this._getScripts(),e.debug(this.id+" resolver: starting resolving"),o.length&&(this._state=this.STATE_RESOLVING,i||(i=window.require("requirejs-sandbox")._getSandboxConstructor()),i.createFrame(null,t.bind(function(e){var r=e.contentWindow;r.onerror=function(){},n(o,r,i.createScript,t.bind(function(t){t?(this._resolvedUrl=t,this._state=this.STATE_RESOLVED):this._state=this.STATE_IDLE,e.parentNode.removeChild(e),e=r=o=null,this._hanldleResolver()},this))},this)));else if(this.state()==this.STATE_RESOLVED)return this._resolvedUrl}},r)}),define("requirejs-sandbox/helpers/resolvers/cdnResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,t,r){return t.defaults({id:"cdn",_resolvedUrl:"//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.9/require.min.js",resolve:function(t){return this.state()==this.STATE_IDLE&&(this._setHandlers(t),e.debug(this.id+" resolver: starting resolving"),this._state=this.STATE_RESOLVED),this._hanldleResolver()}},r)}),define("requirejs-sandbox/helpers/require",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/optionsResolver","requirejs-sandbox/helpers/resolvers/scriptResolver","requirejs-sandbox/helpers/resolvers/iframeResolver","requirejs-sandbox/helpers/resolvers/cdnResolver"],function(e,t,r,n,i,s){function o(e){t.each(h,function(t){"function"==typeof t[0]?t[0](e):a("No fail handler",t[1]||!1)}),c=!1,h.length=l=0}function a(e,r){if(null!=r){if("function"!=typeof r)throw e;r(e)}else t.each(h,function(t){a(e,t[1]||!1)}),c=!1,h.length=l=0}var u=!1,l=0,d=[r,n,i,s],h=[],c=!1;return{id:"main",resolved:function(){return!!u},reset:function(){u=!1,t.each(d,function(e){e.reset()})},resolve:function(){var t,r=this;if(arguments.length)h.push(t=arguments);else{if(!h.length)return void e.error("No handlers passed");t=h[0]}if(!c||!arguments.length)return c=!0,this.resolved()?(e.debug(this.id+" resolver: already resolved as",u),o(u),u):void(null!=d[l]?(e.debug(this.id+' resolver: starting "'+d[l].id+'" resolver'),d[l].resolve(function(e){o(u=e)},function(){l++,r.resolve()},t[2])):(e.debug(this.id+" resolver: all resolvers failed"),a("Unable to resolve require.js source url")))}}}),define("requirejs-sandbox",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/patch","requirejs-sandbox/helpers/require"],function(e,t,r,n){var i={},s=function(r){return this.options=t.defaults(r,{debug:!1,requireUrl:null,requireMain:null,requireConfig:{},sandboxLinks:{},patch:[],plugins:[],success:function(){},error:function(){}}),this.iframe=null,this.sandbox=null,this.requireUrl=null,this.api={name:this.options.name,require:null,define:null,status:-1,destroy:t.bind(function(){this.sandbox=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null;for(var e in this.api)this.api.hasOwnProperty(e)&&delete this.api[e]},this)},this.createSandbox(function(r){e.debug('Sandbox with name "'+this.options.name+'" is created!',r,r.document.body);for(var i in this.options.sandboxLinks)this.options.sandboxLinks.hasOwnProperty(i)&&(r[i]=this.options.sandboxLinks[i]);this.sandbox.sandboxApi=t.extend({},this.api,{parentWindow:window}),n.resolve(t.bind(function(e){this.requireUrl=e,this.createLoader(r)},this),t.bind(function(t){this.api.status=this.sandbox.sandboxApi.status=1,this.options.error.call(this.api),e.error(t)},this),this.options)}),this.api};return s.prototype={createSandbox:function(e){this.createFrame(null,t.bind(function(t){this.iframe=t,this.sandbox=this.iframe.contentWindow,this.createScript(this.sandbox),"function"==typeof e&&e.call(this,this.sandbox)},this))},createFrame:function(t,r){var n=document.createElement("iframe"),i=function(){return"complete"===document.readyState?(e.debug("DOM is ready. Appending iframe"),document.body.appendChild(n),!0):!1},s=function(){"function"==typeof r&&r(n)};n.style.display="none",n.src=t||"javascript:0",n.tabIndex=-1,n.addEventListener?n.addEventListener("load",s,!1):n.attachEvent?n.attachEvent("onload",s):n.onload=s,i()||(e.debug('DOM isn\'t ready. Subscribing to "onreadystatechange" event'),document.onreadystatechange=function(e){return function(){var t;return"function"==typeof e&&(t=e.apply(this,arguments)),i.apply(this,arguments),t}}(document.onreadystatechange))},createScript:function(e,t,r,n,i){var s,o,a=null,u=!1;if("function"==typeof r?(o=n,s=r,r=void 0):(s=n,o=i),e&&e.document&&e.document.body){if(a=e.document.createElement("script"),"object"==typeof r)for(var l in r)r.hasOwnProperty(l)&&null!=r[l]&&a.setAttribute("data-"+l,r[l]);switch(typeof t){case"string":if(t)a.src=t;else if("function"==typeof o)return void o(!1,e);break;case"object":case"undefined":return void("function"==typeof o&&o(!1,e))}"function"==typeof s&&(a.onload=a.onerror=a.onreadystatechange=function(t){u||(u=!0,a.onload=a.onerror=a.onreadystatechange=null,"load"===t.type||"loaded"===this.readyState||"complete"===this.readyState?s(a,e):"function"!=typeof o||"error"!==t.type&&"error"!==this.readyState||o(a,e))}),e.document.getElementsByTagName("head")[0].appendChild(a)}},createLoader:function(r){var i=function(t,r){var i=this.options.patch;if(this.api.require=this.sandbox.sandboxApi.require=r.require,this.api.define=this.sandbox.sandboxApi.define=r.define,this.api.status=this.sandbox.sandboxApi.status=0,this.options.debug&&(this.api.sandboxManager=this),"function"!=typeof this.api.require||"function"!=typeof this.api.define)return n.reset(),this.api.status=this.sandbox.sandboxApi.status=2,this.options.error.call(this.api),void e.error("Can not gain access to require.js inside sandbox");e.debug('require.js has loaded! Patching "load" method...'),this.api.require.load=function(t){return function(n){n.completeLoad.isOverided||(n.completeLoad=function(t){return function(n){for(var s,o,a,u,l=this,d=arguments,h=function(t,i){i.enable(window,r,t),e.debug('Patch for module "'+n+'" applied correctly')},c=function(i){if(e.debug('Found patch for loaded module: "'+n+'"! Applying...'),i)try{if(a=l.registry[n],u=a&&a.shim&&a.shim.exportsFn()||r[i.shimName],null==u){if(!a||!a.events.defined||"function"!=typeof a.events.defined.push)throw"Module registry does not have defined event";a.events.defined.push(function(e){h(e,i)}),t.apply(l,d)}else h(u,i),t.apply(l,d)}catch(s){e.debug('Patch for module "'+n+'" did not applied correctly! Look into debug info for more details'),e.error(n,s)}},f=0,p=i.length;p>f;f++)if("string"==typeof i[f]?(o=i[f],s=!1):"object"==typeof i[f]&&"function"==typeof i[f].enable?(o=i[f].name,s=!0):(o=!1,s=!1),o==n)return void(s?c(i[f]):window.require([["requirejs-sandbox","patches",n].join("/")],c));return t.apply(l,d)}}(n.completeLoad),n.completeLoad.isOverided=!0),t.apply(this,arguments)}}(this.api.require.load),e.debug('require.js "load" method has been patched! Configuring...'),this.api.require.config(this.options.requireConfig);for(var s=0,o=this.options.plugins.length;o>s;s++){var a=this.options.plugins[s],u=""+a.name,l=!1;u||(e.error("Registered plugin has no name"),l=!0),"function"!=typeof a.handler&&(e.error("Registered plugin handler is not a function"),l=!0),e.debug("Successfuly registered plugin with name: "+u),l||this.api.define(u,a.handler)}e.debug("Creating predefined modules"),this.api.define("sandbox",function(){return r}),e.debug("Executing module callback"),this.options.success.call(this.api,this.api.require,this.api.define)};this.createScript(r,this.requireUrl,{main:this.options.requireMain},t.bind(i,this),t.bind(function(){n.reset(),this.api.status=this.sandbox.sandboxApi.status=3,this.options.error.call(this.api),e.error("Can not load require.js into sandbox")},this)),e.debug("Creating loader inside specified target:",r)}},e.setLogLevel("debug"),e.setNamespace("requirejs-sandbox"),{_getSandboxConstructor:function(){return s.prototype},get:function(e){return i[e]},set:function(r,n){var o;return"string"==typeof r?(o=this.get(r),o&&o.status<=0?(e.warn("Sandbox with name: "+r+" already exist! Returning existed sandbox.",o),o):i[r]=new s(t.extend({},n,{name:r}))):void e.error("Sandbox name should be string")},destroy:function(t){var r=this.get(t);r?(r.destroy(),delete i[t]):e.warn('Sandbox with name: "'+t+'" was not found')}}});