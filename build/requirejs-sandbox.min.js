/**
 * requrejs-sandbox - v0.1.4-23 (build date: 21/07/2013)
 * https://github.com/a-ignatov-parc/requirejs-sandbox
 * Module for requre.js to create sandbox enviroment to run dedicated apps
 * Copyright (c) 2013 Anton Ignatov
 * Licensed MIT
 */
define("requirejs-sandbox",["requirejs-sandbox/transits","requirejs-sandbox/logger","requirejs-sandbox/utils"],function(a,b,c){var d={},e=function(a){return this.options=c.extend({requireUrl:null,requireMain:null,requireConfig:{}},a),this.iframe=null,this.sandbox=null,this.api={name:this.options.name,require:null,destroy:this.bind(function(){this.sandbox=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null},this)},this.createSandbox(function(a){b.debug('Sandbox with name "'+this.options.name+'" is created!',a,a.document.body),this.createLoader(a)}),this.api};return e.prototype={createSandbox:function(a){this.createFrame(null,this.bind(function(b){this.iframe=b,this.sandbox=this.iframe.contentWindow,this.createScript(this.sandbox),"function"==typeof a&&a.call(this,this.sandbox)},this))},createFrame:function(a,c){var d=document.createElement("iframe"),e=function(){return"complete"===document.readyState?(b.debug("DOM is ready. Appending iframe"),document.body.appendChild(d),!0):!1},f=function(){"function"==typeof c&&c(d)};d.style.display="none",d.src=a||"javascript:0",d.tabIndex=-1,d.addEventListener?d.addEventListener("load",f,!1):d.attachEvent?d.attachEvent("onload",f):d.onload=f,e()||(b.debug('DOM isn\'t ready. Subscribing to "onreadystatechange" event'),document.onreadystatechange=function(a){return function(){var b=a.apply(this,arguments);return e.apply(this,arguments),b}}(document.onreadystatechange))},createScript:function(a,b,c,d){var e=null,f=!1;if("function"==typeof c&&null==d&&(d=c,c=void 0),a&&a.document&&a.document.body){if(e=a.document.createElement("script"),"object"==typeof c)for(var g in c)c.hasOwnProperty(g)&&null!=c[g]&&e.setAttribute("data-"+g,c[g]);"string"==typeof b&&b&&(e.src=b),"function"==typeof d&&(e.onload=e.onreadystatechange=function(){f||null!=this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(f=!0,e.onload=e.onreadystatechange=null,d(a))}),a.document.body.appendChild(e)}},createLoader:function(a){var c=function(a){this.api.require=a.require,b.debug("require.js has loaded! Configuring..."),this.api.require.config(this.options.requireConfig),this.createTransitPlugin(a.define),this.createCssPlugin(a.define),b.debug("Executing module callback"),"function"==typeof this.options.callback&&this.options.callback(a.require)};if(!this.options.requireUrl)throw"Unable to create loader";this.createScript(a,this.options.requireUrl,{main:this.options.requireMain},this.bind(c,this)),b.debug("Creating loader inside specified target:",a)},createTransitPlugin:function(c){var d=this.sandbox;b.debug("Creating plugin for loading transits"),c("transit",function(){return{load:function(c,e,f){b.debug("Received module load exec for",c),e([c],function(e){if(f(e),a[c])try{a[c].enable(window,d,e)}catch(g){b.error(g)}})}}})},createCssPlugin:function(a){b.debug("Creating plugin for loading css"),a("css",this.bind(function(){return{load:this.bind(function(a,c,d,e){var f=e.baseUrl+a+".css";b.debug("Received css load exec for",a),this.createFrame(f,function(a){b.debug("frame with css is loaded. Appending link and removing frame");var c=window.document.createElement("link");c.rel="stylesheet",c.type="text/css",c.href=f,window.document.body.appendChild(c),a.parentNode.removeChild(a),d({cssLink:c})})},this)}},this))},bind:function(a,b){return b||(b=window),"function"==typeof a?function(){return a.apply(b,arguments)}:a}},b.setLogLevel("debug"),b.setNamespace("requirejs-sandbox"),{get:function(a){return d[a]?d[a]:void 0},set:function(a,f){var g;return"string"==typeof a&&"object"==typeof f?(g=this.get(a))?(b.warn("Sandbox with name: "+a+" already exist! Returning existed sandbox.",g),g):d[a]=new e(c.extend({},f,{name:a})):void 0},destroy:function(a){var b=this.get(a);b&&b.destroy()}}}),define("requirejs-sandbox/transits",["requirejs-sandbox/transit.jquery"],function(){for(var a={},b=0,c=arguments.length;c>b;b++)null!=arguments[b]&&(a[arguments[b].name]=arguments[b]);return a}),define("requirejs-sandbox/transit.jquery",["requirejs-sandbox/logger"],function(a){return{name:"jquery",enable:function(b,c,d){return"function"!=typeof d?(a.error("This transit require jQuery to be defined!"),void 0):(c.getComputedStyle&&b.getComputedStyle&&(c.getComputedStyle=function(){return b.getComputedStyle.apply(b,arguments)}),d.fn.__patchedInit?(a.debug("jQuery already patched. Skipping..."),void 0):(d.fn.init=function(a,d){return d.__originalInit||(d.__originalInit=a),d.__patchedInit=function(d,e,f){return"string"!=typeof d||e?d==c&&e!=c?new a(b,e,f):d==c.document?new a(b.document,e,f):d==c.document.head?new a(b.document.head,e,f):d==c.document.body?new a(b.document.body,e,f):new a(d,e,f):new a(d,b.document,f)},d.__patchedInit.prototype=d,d.__patchedInit}(d.fn.init,d.fn),void 0))},disable:function(b,c,d){d.fn.__originalInit?(a.debug("Restoring original jQuery instance"),d.fn.init=d.fn.__originalInit,delete d.fn.__originalInit,delete d.fn.__patchedInit):a.warn("jQuery wasn't patched. Skipping...")}}}),define("requirejs-sandbox/utils",function(){var a=Array.prototype,b=Object.prototype,c=b.hasOwnProperty,d=a.forEach,e=a.slice,f={};return{has:function(a,b){return c.call(a,b)},each:function(a,b,c){if(null!=a)if(d&&a.forEach===d)a.forEach(b,c);else if(a.length===+a.length){for(var e=0,g=a.length;g>e;e++)if(b.call(c,a[e],e,a)===f)return}else for(var h in a)if(this.has(a,h)&&b.call(c,a[h],h,a)===f)return},extend:function(a){return this.each(e.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a}}}),define("requirejs-sandbox/logger",function(){var a="logger";return{setLogLevel:function(){},setNamespace:function(b){a=b},debug:function(){},info:function(){},warn:function(){var b=Array.prototype.slice.call(arguments);b.unshift(a),console.warn.apply(this,arguments)},error:function(){var b=Array.prototype.slice.call(arguments);b.unshift(a),console.error.apply(this,arguments)},off:function(){}}});