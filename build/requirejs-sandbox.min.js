/**
 * requirejs-sandbox - v0.4.3-31 (build date: 14/03/2014)
 * https://github.com/a-ignatov-parc/requirejs-sandbox
 * Sandbox manager for require.js allows user to run multiple apps without scope intersection issues
 * Copyright (c) 2014 Anton Ignatov
 * Licensed MIT
 */
define("requirejs-sandbox/logger/logger",function(){var e="logger";return{setLogLevel:function(){},setNamespace:function(t){e=t},log:function(){},debug:function(){},info:function(){},warn:function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),console.warn.apply(this,arguments)},error:function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),console.error.apply(this,arguments)},off:function(){}}}),define("requirejs-sandbox/helpers/utils",function(){var e=Array.prototype,t=Object.prototype,r=t.hasOwnProperty,n=e.forEach,s=e.slice,i={};return{has:function(e,t){return r.call(e,t)},each:function(e,t,r){if(null!=e)if(n&&e.forEach===n)e.forEach(t,r);else if(e.length===+e.length){for(var s=0,o=e.length;o>s;s++)if(t.call(r,e[s],s,e)===i)return}else for(var a in e)if(this.has(e,a)&&t.call(r,e[a],a,e)===i)return},extend:function(e){return this.each(s.call(arguments,1),function(t){if(t)for(var r in t)e[r]=t[r]}),e},bind:function(e,t){return t||(t=window),"function"==typeof e?function(){return e.apply(t,arguments)}:e},defaults:function(e){return this.each(s.call(arguments,1),function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])}),e},scripts:function(){return Array.prototype.slice.call(document.getElementsByTagName("script"),0)}}}),define("requirejs-sandbox/helpers/patch",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils"],function(e,t){var r={_options:{},name:"default",shimName:"default",enable:function(){e.warn("Method is not implemented")},disable:function(){e.warn("Method is not implemented")},setOptions:function(e){var r=function(e){this._options=t.extend({},this._options,e)};return r.prototype=this,new r(e)}};return{init:function(e){return t.defaults(e||{},r)}}}),define("requirejs-sandbox/helpers/resolvers/abstract",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils"],function(e,t){var r={STATE_IDLE:"idle",STATE_RESOLVING:"resolving",STATE_RESOLVED:"resolved",_state:null,_resolvedUrl:!1,_onSuccess:function(){e.warn("No success handler defined for "+this.id+" resolver! Use _setHandlers() method to do this.")},_onFail:function(){e.warn("No fail handler defined for "+this.id+" resolver! Use _setHandlers() method to do this.")},_setHandlers:function(e,t){"function"==typeof e&&(this._onSuccess=e),"function"==typeof t&&(this._onFail=t)},_hanldleResolver:function(){switch(this.state()){case this.STATE_RESOLVED:return e.debug(this.id+" resolver: resolved",this._resolvedUrl),this._onSuccess(this._resolvedUrl),this._resolvedUrl;case this.STATE_IDLE:return e.debug(this.id+" resolver: failed to resolve"),void this._onFail();default:return}},_getScripts:function(){return t.scripts()},state:function(){return this._state},resolve:function(){e.error("Not implemented!")},reset:function(){return this._state=this.STATE_IDLE,this}};return r.reset()}),define("requirejs-sandbox/helpers/resolvers/optionsResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,t,r){return t.defaults({id:"options",resolve:function(t,r,n){return this.state()==this.STATE_IDLE&&(this._setHandlers(t,r),e.debug(this.id+" resolver: starting resolving"),n&&"string"==typeof n.requireUrl&&(this._resolvedUrl=n.requireUrl,this._state=this.STATE_RESOLVED)),this._hanldleResolver()}},r)}),define("requirejs-sandbox/helpers/resolvers/scriptResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,t,r){var n=/require(?:[.-]min)?.js$/;return t.defaults({id:"script",_checkUrl:function(e){return n.test(e)},resolve:function(r,n){return this.state()==this.STATE_IDLE&&(this._setHandlers(r,n),e.debug(this.id+" resolver: starting resolving"),t.each(this._getScripts(),t.bind(function(e){return this._checkUrl(e.getAttribute("src"))?(this._resolvedUrl=e.getAttribute("src"),this._state=this.STATE_RESOLVED,!0):void 0},this))),this._hanldleResolver()}},r)}),define("requirejs-sandbox/helpers/resolvers/iframeResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,t,r){function n(e,t,r,s){e.length?r(t,e.shift().getAttribute("src"),function(i){"function"==typeof t.require&&"function"==typeof t.requirejs&&"function"==typeof t.define?s(i.getAttribute("src")):n(e,t,r,s)},function(){n(e,t,r,s)}):s(!1)}var s;return t.defaults({id:"iframe",resolve:function(r,i){var o;if(this.state()==this.STATE_IDLE)this._setHandlers(r,i),o=this._getScripts(),e.debug(this.id+" resolver: starting resolving"),o.length&&(this._state=this.STATE_RESOLVING,s||(s=window.require("requirejs-sandbox")._getSandboxConstructor()),s.createFrame(null,t.bind(function(e){var r=e.contentWindow;r.onerror=function(){},n(o,r,s.createScript,t.bind(function(t){t?(this._resolvedUrl=t,this._state=this.STATE_RESOLVED):this._state=this.STATE_IDLE,e.parentNode.removeChild(e),e=r=o=null,this._hanldleResolver()},this))},this)));else if(this.state()==this.STATE_RESOLVED)return this._resolvedUrl}},r)}),define("requirejs-sandbox/helpers/resolvers/cdnResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,t,r){return t.defaults({id:"cdn",_resolvedUrl:"//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.9/require.min.js",resolve:function(t){return this.state()==this.STATE_IDLE&&(this._setHandlers(t),e.debug(this.id+" resolver: starting resolving"),this._state=this.STATE_RESOLVED),this._hanldleResolver()}},r)}),define("requirejs-sandbox/helpers/require",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/optionsResolver","requirejs-sandbox/helpers/resolvers/scriptResolver","requirejs-sandbox/helpers/resolvers/iframeResolver","requirejs-sandbox/helpers/resolvers/cdnResolver"],function(e,t,r,n,s,i){function o(e){t.each(c,function(t){"function"==typeof t[0]?t[0](e):a("No fail handler",t[1]||!1)}),h=!1,c.length=d=0}function a(e,r){if(null!=r){if("function"!=typeof r)throw e;r(e)}else t.each(c,function(t){a(e,t[1]||!1)}),h=!1,c.length=d=0}var u=!1,d=0,l=[r,n,s,i],c=[],h=!1;return{id:"main",resolved:function(){return!!u},reset:function(){u=!1,t.each(l,function(e){e.reset()})},resolve:function(){var t,r=this;if(arguments.length)c.push(t=arguments);else{if(!c.length)return void e.error("No handlers passed");t=c[0]}if(!h||!arguments.length)return h=!0,this.resolved()?(e.debug(this.id+" resolver: already resolved as",u),o(u),u):void(null!=l[d]?(e.debug(this.id+' resolver: starting "'+l[d].id+'" resolver'),l[d].resolve(function(e){o(u=e)},function(){d++,r.resolve()},t[2])):(e.debug(this.id+" resolver: all resolvers failed"),a("Unable to resolve require.js source url")))}}}),define("requirejs-sandbox/helpers/preprocess",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils"],function(e){e.debug("Creating plugin for loading and preprocessing resources");var t,r=function(t,r){return"boolean"!=typeof t&&1!=t&&0!=t?(e.debug("Creating simple response with status: "+t),{status:t}):(this.status="boolean"==typeof t?+!t:+t,this.id=s.push(r||"")-1,e.debug("Creating extended resource api with status: "+this.status),void 0)},n=function(){return{load:function(t,n,s){var i,o=function(){switch(this.status){case 200:case 302:e.debug("File received correctly",t),s(new r(!0,this.response));break;case 404:e.debug("File was not found",t),s(new r);break;default:e.debug("Received unhandled status",t,this.status),s(new r)}},a=function(){e.debug("Something goes wrong",t,this.status),s(new r)};e.debug("Received resource load exec for",t),"function"==typeof XMLHttpRequest?(i=new XMLHttpRequest,i.open("GET",n.toUrl(t)+".js",!0),i.onload=o,i.onerror=a,i.send()):(e.log(123,"Need to do somthing here"),n([t],function(){s({status:2})}))}}},s=[],i=/^\s*define\((['"][^'"]+['"])?,?\s*(?:\[([^\]]+)\])?,?\s*(function[^]+)\);*\s*$/;return r.prototype={replace:function(t,r){return e.debug('Executing replace with pattern: "'+t+'" and replace: "'+r+'"'),s[this.id]=s[this.id].replace(t,r),e.debug("Executing result: ",s[this.id]),this},resolve:function(r){var n,o,a,u=s[this.id],d=i.exec(u);if(e.debug("Execution context",t),d){e.debug('module name: "'+d[1]+'"'),e.debug('module deps: "'+d[2]+'"'),e.debug('module handler: "'+d[3]+'"'),a=new t.Function("return "+d[3]);try{o=a()}catch(l){e.error(l)}if(d[2]){var c=d[2].replace(/['"]*\s*/g,""),h=c.split(",");e.debug("Dependencies resolved to: ["+h.join(", ")+"]"),t.require(h,function(){try{n=o.apply(this,arguments)}catch(t){e.error(t)}"function"==typeof r&&r(n)})}else{try{n=o()}catch(l){e.error(l)}"function"==typeof r&&r(n)}}else{a=new t.Function(u);try{a()}catch(l){e.error(l)}}return this},autoWrap:function(){return s[this.id]="with(window.sandboxApi.windowProxy || window) {;"+s[this.id]+";}",this}},{name:"preprocess",handler:n,setContext:function(e){t=e||window}}}),define("requirejs-sandbox",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/patch","requirejs-sandbox/helpers/require","requirejs-sandbox/helpers/preprocess"],function(e,t,r,n,s){var i={},o=function(r){return this.options=t.defaults(r,{debug:!1,requireUrl:null,requireMain:null,requireConfig:{},sandboxLinks:{},patch:[],plugins:[],success:function(){},error:function(){}}),this.iframe=null,this.sandbox=null,this.requireUrl=null,this.api={name:this.options.name,require:null,define:null,status:-1,destroy:t.bind(function(){this.sandbox=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null;for(var e in this.api)this.api.hasOwnProperty(e)&&delete this.api[e]},this)},this.createSandbox(function(r){e.debug('Sandbox with name "'+this.options.name+'" is created!',r,r.document.body);for(var s in this.options.sandboxLinks)this.options.sandboxLinks.hasOwnProperty(s)&&(r[s]=this.options.sandboxLinks[s]);this.sandbox.sandboxApi=t.extend({},this.api,{parentWindow:window}),n.resolve(t.bind(function(e){this.requireUrl=e,this.createLoader(r)},this),t.bind(function(t){this.api.status=this.sandbox.sandboxApi.status=1,this.options.error.call(this.api),e.error(t)},this),this.options)}),this.api};return o.prototype={createSandbox:function(e){this.createFrame(null,t.bind(function(t){this.iframe=t,this.sandbox=this.iframe.contentWindow,this.createScript(this.sandbox),"function"==typeof e&&e.call(this,this.sandbox)},this))},createFrame:function(t,r){var n=document.createElement("iframe"),s=function(){return"complete"===document.readyState?(e.debug("DOM is ready. Appending iframe"),document.body.appendChild(n),!0):!1},i=function(){"function"==typeof r&&r(n)};n.style.display="none",n.src=t||"javascript:0",n.tabIndex=-1,n.addEventListener?n.addEventListener("load",i,!1):n.attachEvent?n.attachEvent("onload",i):n.onload=i,s()||(e.debug('DOM isn\'t ready. Subscribing to "onreadystatechange" event'),document.onreadystatechange=function(e){return function(){var t;return"function"==typeof e&&(t=e.apply(this,arguments)),s.apply(this,arguments),t}}(document.onreadystatechange))},createScript:function(e,t,r,n,s){var i,o,a=null,u=!1;if("function"==typeof r?(o=n,i=r,r=void 0):(i=n,o=s),e&&e.document&&e.document.body){if(a=e.document.createElement("script"),"object"==typeof r)for(var d in r)r.hasOwnProperty(d)&&null!=r[d]&&a.setAttribute("data-"+d,r[d]);switch(typeof t){case"string":if(t)a.src=t;else if("function"==typeof o)return void o(!1,e);break;case"object":case"undefined":return void("function"==typeof o&&o(!1,e))}"function"==typeof i&&(a.onload=a.onerror=a.onreadystatechange=function(t){u||(u=!0,a.onload=a.onerror=a.onreadystatechange=null,"load"===t.type||"loaded"===this.readyState||"complete"===this.readyState?i(a,e):"function"!=typeof o||"error"!==t.type&&"error"!==this.readyState||o(a,e))}),e.document.getElementsByTagName("head")[0].appendChild(a)}},createLoader:function(r){var i=function(t,r){var i=this.options.patch;if(this.api.require=this.sandbox.sandboxApi.require=r.require,this.api.define=this.sandbox.sandboxApi.define=r.define,this.api.status=this.sandbox.sandboxApi.status=0,this.options.debug&&(this.api.sandboxManager=this),"function"!=typeof this.api.require||"function"!=typeof this.api.define)return n.reset(),this.api.status=this.sandbox.sandboxApi.status=2,this.options.error.call(this.api),void e.error("Can not gain access to require.js inside sandbox");e.debug('require.js has loaded! Patching "load" method...'),this.api.require.load=function(t){return function(n){n.completeLoad.isOverided||(n.completeLoad=function(t){return function(n){for(var s,o,a,u,d=this,l=arguments,c=function(t,s){s.enable(window,r,t),e.debug('Patch for module "'+n+'" applied correctly')},h=function(s){if(e.debug('Found patch for loaded module: "'+n+'"! Applying...'),s)try{if(a=d.registry[n],u=a&&a.shim&&a.shim.exportsFn()||r[s.shimName],null==u){if(!a||!a.events.defined||"function"!=typeof a.events.defined.push)throw"Module registry does not have defined event";a.events.defined.push(function(e){c(e,s)}),t.apply(d,l)}else c(u,s),t.apply(d,l)}catch(i){e.debug('Patch for module "'+n+'" did not applied correctly! Look into debug info for more details'),e.error(n,i)}},f=0,p=i.length;p>f;f++)if("string"==typeof i[f]?(o=i[f],s=!1):"object"==typeof i[f]&&"function"==typeof i[f].enable?(o=i[f].name,s=!0):(o=!1,s=!1),o==n)return void(s?h(i[f]):window.require([["requirejs-sandbox","patches",n].join("/")],h));return t.apply(d,l)}}(n.completeLoad),n.completeLoad.isOverided=!0),t.apply(this,arguments)}}(this.api.require.load),e.debug('require.js "load" method has been patched! Configuring...'),this.api.require.config(this.options.requireConfig);for(var o=0,a=this.options.plugins.length;a>o;o++){var u=this.options.plugins[o],d=""+u.name,l=!1;d||(e.error("Registered plugin has no name"),l=!0),"function"!=typeof u.handler&&(e.error("Registered plugin handler is not a function"),l=!0),e.debug("Successfuly registered plugin with name: "+d),l||this.api.define(d,u.handler)}e.debug("Creating predefined modules"),this.api.define("sandbox",function(){return r}),e.debug('Creating "preprocess" plugin for sandbox require.js'),s.setContext(r),this.api.define(s.name,s.handler),e.debug("Executing module callback"),this.options.success.call(this.api,this.api.require,this.api.define)};this.createScript(r,this.requireUrl,{main:this.options.requireMain},t.bind(i,this),t.bind(function(){n.reset(),this.api.status=this.sandbox.sandboxApi.status=3,this.options.error.call(this.api),e.error("Can not load require.js into sandbox")},this)),e.debug("Creating loader inside specified target:",r)}},e.setLogLevel("debug"),e.setNamespace("requirejs-sandbox"),{_getSandboxConstructor:function(){return o.prototype},get:function(e){return i[e]},set:function(r,n){var s;return"string"==typeof r?(s=this.get(r),s&&s.status<=0?(e.warn("Sandbox with name: "+r+" already exist! Returning existed sandbox.",s),s):i[r]=new o(t.extend({},n,{name:r}))):void e.error("Sandbox name should be string")},destroy:function(t){var r=this.get(t);r?(r.destroy(),delete i[t]):e.warn('Sandbox with name: "'+t+'" was not found')}}});