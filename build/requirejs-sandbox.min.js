/**
 * requirejs-sandbox - v0.5.0-9 (build date: 23/06/2014)
 * https://github.com/a-ignatov-parc/requirejs-sandbox
 * Sandbox manager for require.js allows user to run multiple apps without scope intersection issues
 * Copyright (c) 2014 Anton Ignatov
 * Licensed MIT
 */
define("requirejs-sandbox/logger/logger",function(){var e="logger";return{setLogLevel:function(){},setNamespace:function(r){e=r},log:function(){},debug:function(){},info:function(){},warn:function(){var r=Array.prototype.slice.call(arguments);r.unshift(e),console.warn.apply(this,arguments)},error:function(){var r=Array.prototype.slice.call(arguments);r.unshift(e),console.error.apply(this,arguments)},off:function(){}}}),define("requirejs-sandbox/helpers/utils",function(){var e=Array.prototype,r=Object.prototype,t=r.hasOwnProperty,n=e.forEach,s=e.slice,i={},o=document.createElement("a");return{has:function(e,r){return t.call(e,r)},each:function(e,r,t){if(null!=e)if(n&&e.forEach===n)e.forEach(r,t);else if(e.length===+e.length){for(var s=0,o=e.length;o>s;s++)if(r.call(t,e[s],s,e)===i)return}else for(var a in e)if(this.has(e,a)&&r.call(t,e[a],a,e)===i)return},extend:function(e){return this.each(s.call(arguments,1),function(r){if(r)for(var t in r)e[t]=r[t]}),e},bind:function(e,r){return r||(r=window),"function"==typeof e?function(){return e.apply(r,arguments)}:e},defaults:function(e){return this.each(s.call(arguments,1),function(r){if(r)for(var t in r)void 0===e[t]&&(e[t]=r[t])}),e},scripts:function(){return Array.prototype.slice.call(document.getElementsByTagName("script"),0)},urlToLocation:function(e){return o.href=e,{href:o.href,host:o.host,port:o.port,hash:o.hash,origin:o.origin,search:o.search,protocol:o.protocol,hostname:o.hostname,pathname:o.pathname}}}}),define("requirejs-sandbox/helpers/resolvers/abstract",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils"],function(e,r){var t={STATE_IDLE:"idle",STATE_RESOLVING:"resolving",STATE_RESOLVED:"resolved",_state:null,_resolvedUrl:!1,_onSuccess:function(){e.warn("No success handler defined for "+this.id+" resolver! Use _setHandlers() method to do this.")},_onFail:function(){e.warn("No fail handler defined for "+this.id+" resolver! Use _setHandlers() method to do this.")},_setHandlers:function(e,r){"function"==typeof e&&(this._onSuccess=e),"function"==typeof r&&(this._onFail=r)},_hanldleResolver:function(){switch(this.state()){case this.STATE_RESOLVED:return e.debug(this.id+" resolver: resolved",this._resolvedUrl),this._onSuccess(this._resolvedUrl),this._resolvedUrl;case this.STATE_IDLE:return e.debug(this.id+" resolver: failed to resolve"),void this._onFail();default:return}},_getScripts:function(){return r.scripts()},state:function(){return this._state},resolve:function(){e.error("Not implemented!")},reset:function(){return this._state=this.STATE_IDLE,this}};return t.reset()}),define("requirejs-sandbox/helpers/resolvers/optionsResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,r,t){return r.defaults({id:"options",resolve:function(r,t,n){return this.state()==this.STATE_IDLE&&(this._setHandlers(r,t),e.debug(this.id+" resolver: starting resolving"),n&&"string"==typeof n.requireUrl&&(this._resolvedUrl=n.requireUrl,this._state=this.STATE_RESOLVED)),this._hanldleResolver()}},t)}),define("requirejs-sandbox/helpers/resolvers/scriptResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,r,t){var n=/require(?:[.-]min)?.js$/;return r.defaults({id:"script",_checkUrl:function(e){return n.test(e)},resolve:function(t,n){return this.state()==this.STATE_IDLE&&(this._setHandlers(t,n),e.debug(this.id+" resolver: starting resolving"),r.each(this._getScripts(),r.bind(function(e){return this._checkUrl(e.getAttribute("src"))?(this._resolvedUrl=e.getAttribute("src"),this._state=this.STATE_RESOLVED,!0):void 0},this))),this._hanldleResolver()}},t)}),define("requirejs-sandbox/helpers/resolvers/iframeResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,r,t){function n(e,r,t,s){e.length?t(r,e.shift().getAttribute("src"),function(i){"function"==typeof r.require&&"function"==typeof r.requirejs&&"function"==typeof r.define?s(i.getAttribute("src")):n(e,r,t,s)},function(){n(e,r,t,s)}):s(!1)}var s;return r.defaults({id:"iframe",resolve:function(t,i){var o;if(this.state()==this.STATE_IDLE)this._setHandlers(t,i),o=this._getScripts(),e.debug(this.id+" resolver: starting resolving"),o.length&&(this._state=this.STATE_RESOLVING,s||(s=window.require("requirejs-sandbox")._getSandboxInternalInterface()),s.createFrame(null,r.bind(function(e){var t=e.contentWindow;t.onerror=function(){},n(o,t,s.createScript,r.bind(function(r){r?(this._resolvedUrl=r,this._state=this.STATE_RESOLVED):this._state=this.STATE_IDLE,e.parentNode.removeChild(e),e=t=o=null,this._hanldleResolver()},this))},this)));else if(this.state()==this.STATE_RESOLVED)return this._resolvedUrl}},t)}),define("requirejs-sandbox/helpers/resolvers/cdnResolver",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/abstract"],function(e,r,t){return r.defaults({id:"cdn",_resolvedUrl:"//cdnjs.cloudflare.com/ajax/libs/require.js/2.1.9/require.min.js",resolve:function(r){return this.state()==this.STATE_IDLE&&(this._setHandlers(r),e.debug(this.id+" resolver: starting resolving"),this._state=this.STATE_RESOLVED),this._hanldleResolver()}},t)}),define("requirejs-sandbox/helpers/require",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/resolvers/optionsResolver","requirejs-sandbox/helpers/resolvers/scriptResolver","requirejs-sandbox/helpers/resolvers/iframeResolver","requirejs-sandbox/helpers/resolvers/cdnResolver"],function(e,r,t,n,s,i){function o(e){r.each(c,function(r){"function"==typeof r[0]?r[0](e):a("No fail handler",r[1]||!1)}),h=!1,c.length=d=0}function a(e,t){if(null!=t){if("function"!=typeof t)throw e;t(e)}else r.each(c,function(r){a(e,r[1]||!1)}),h=!1,c.length=d=0}var u=!1,d=0,l=[t,n,s,i],c=[],h=!1;return{id:"main",resolved:function(){return!!u},reset:function(){u=!1,r.each(l,function(e){e.reset()})},resolve:function(){var r,t=this;if(arguments.length)c.push(r=arguments);else{if(!c.length)return void e.error("No handlers passed");r=c[0]}if(!h||!arguments.length)return h=!0,this.resolved()?(e.debug(this.id+" resolver: already resolved as",u),o(u),u):void(null!=l[d]?(e.debug(this.id+' resolver: starting "'+l[d].id+'" resolver'),l[d].resolve(function(e){o(u=e)},function(){d++,t.resolve()},r[2])):(e.debug(this.id+" resolver: all resolvers failed"),a("Unable to resolve require.js source url")))}}}),define("requirejs-sandbox/helpers/preprocess/abstract",["requirejs-sandbox/logger/logger"],function(e){return{Processor:null,loadHandler:function(r,t){var n=this.Processor;return function(){switch(this.status){case 0:case 200:case 302:e.debug("File received correctly",r),t(new n(!0,this.response));break;case 404:e.debug("File was not found",r),t(new n(3));break;default:e.debug("Received unhandled status",r,this.status),t(new n(4))}}},errorHandler:function(r,t){var n=this.Processor;return function(){e.debug("Something goes wrong",r,this.status),t(new n(5))}},checkXMLHttpRequestSupport:function(){return"function"==typeof XMLHttpRequest||"object"==typeof XMLHttpRequest},createAjaxLoader:function(e,r,t,n){var s=new XMLHttpRequest;return s.open("GET",r.toUrl(e)+(n||".js"),!0),s.onload=this.loadHandler(e,t),s.onerror=this.errorHandler(e,t),{load:function(){s.send()}}},createDefaultLoader:function(e,r,t){var n=this.Processor;return{load:function(){r([e],function(){t(new n(2))})}}}}}),define("requirejs-sandbox/helpers/processor/core",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils"],function(e,r){var t=[],n=/^\s*define\((['"][^'"]+['"])?,?\s*(?:\[([^\]]+)\])?,?\s*(function[^]+)\);*\s*$/,s=/['"]*\s*/g;return function(i){var o=i||window,a=function(r,t){return this.id=this._responseSourceCache.push(t||"")-1,this.target=o,"boolean"!=typeof r&&1!==r&&0!==r&&"1"!==r&&"0"!==r?(e.debug("Creating simple response with status: "+r),{id:this.id,status:r||6}):(this.status="boolean"==typeof r?+!r:+r,void e.debug("Creating extended resource api with status: "+this.status))};return a.extend=function(){for(var e=0,t=arguments.length;t>e;e++)r.extend(a.prototype,arguments[e])},a.prototype={_responseSourceCache:t,replace:function(r,t){return e.debug('[replace] Executing replace with pattern: "'+r+'" and replace: "'+t+'"'),this._responseSourceCache[this.id]=this._responseSourceCache[this.id].replace(r,t),e.debug("[replace] Executing result: "+this._responseSourceCache[this.id]),this},resolve:function(r){var t,i,a,u,d,l=this._responseSourceCache[this.id],c=n.exec(l);if(e.debug("Execution context",o),c){c[1]&&(u=c[1].replace(s,"")),d=c[2]?c[2].replace(s,"").split(","):[],e.debug('module name: "'+u+'"'),e.debug("module deps: ["+d.join(", ")+"]"),e.debug('module handler: "'+c[3]+'"'),a=new o.Function("return "+c[3]);try{i=a()}catch(h){e.error(h)}if(u)o.define(u,d,function(){try{t=i.apply(this,arguments)}catch(r){e.error(r)}return t}),o.require([u],function(e){"function"==typeof r&&r(e)});else if(d.length)o.require(d,function(){try{t=i.apply(this,arguments)}catch(n){e.error(n)}"function"==typeof r&&r(t)});else{try{t=i()}catch(h){e.error(h)}"function"==typeof r&&r(t)}}else{var f=o.document.createElement("script");f.type="text/javascript",f.text=l,o.document.getElementsByTagName("head")[0].appendChild(f),"function"==typeof r&&r()}return this}},a}}),define("requirejs-sandbox/helpers/processor/autofix",["requirejs-sandbox/logger/logger"],function(e){return{autoFix:function(r){for(var t=["location","document"].concat(r||[]),n={},s=0,i=t.length;i>s;s++){var o=t[s].split(".").pop(),a="__window_"+o.toLowerCase();n[t[s]]||(n[t[s]]=!0,this.target[a]=this.target.sandboxApi&&this.target.sandboxApi.parentWindow[o]||this.target[o],this._responseSourceCache[this.id]=this._responseSourceCache[this.id].replace(new RegExp("(\\W)"+o+"(\\W)","g"),"$1"+a+"$2"))}return e.debug("[autoFix] Executing result: "+this._responseSourceCache[this.id]),this}}}),define("requirejs-sandbox/helpers/preprocess/plugin",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/preprocess/abstract","requirejs-sandbox/helpers/processor/core","requirejs-sandbox/helpers/processor/autofix"],function(e,r,t,n,s){return e.debug("Creating plugin for loading and preprocessing resources"),function(i){var o=new n(i),a=r.extend({},t,{Processor:o});return o.extend(s),{name:"preprocess",handler:function(){return{load:function(r,t,n){var s;e.debug("Received resource load exec for",r),s=a.checkXMLHttpRequestSupport()?a.createAjaxLoader(r,t,n):a.createDefaultLoader(r,t,n),s.load()}}}}}}),define("requirejs-sandbox",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils","requirejs-sandbox/helpers/require","requirejs-sandbox/helpers/preprocess/plugin"],function(e,r,t,n){var s={},i=function(n){return this.options=r.defaults(n,{debug:!1,requireUrl:null,requireMain:null,requireConfig:{},sandboxLinks:{},patch:[],plugins:[],success:function(){},error:function(){}}),this.iframe=null,this.sandbox=null,this.requireUrl=null,this.api={name:this.options.name,require:null,define:null,status:-1,destroy:r.bind(function(){this.sandbox=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null;for(var e in this.api)this.api.hasOwnProperty(e)&&delete this.api[e]},this)},this.createSandbox(function(n){e.debug('Sandbox with name "'+this.options.name+'" is created!',n,n.document.body);for(var s in this.options.sandboxLinks)this.options.sandboxLinks.hasOwnProperty(s)&&(n[s]=this.options.sandboxLinks[s]);this.sandbox.sandboxApi=r.extend({},this.api,{parentWindow:window}),t.resolve(r.bind(function(e){this.requireUrl=e,this.createLoader(n)},this),r.bind(function(r){this.api.status=this.sandbox.sandboxApi.status=1,this.options.error.call(this.api),e.error(r)},this),this.options)}),this.api};return i.prototype={createSandbox:function(e){this.createFrame(null,r.bind(function(r){this.iframe=r,this.sandbox=this.iframe.contentWindow,this.createScript(this.sandbox),"function"==typeof e&&e.call(this,this.sandbox)},this))},createFrame:function(r,t){var n=document.createElement("iframe"),s=function(){return"complete"===document.readyState?(e.debug("DOM is ready. Appending iframe"),document.body.appendChild(n),!0):!1},i=function(){"function"==typeof t&&t(n)};n.style.display="none",n.src=r||"javascript:0",n.tabIndex=-1,n.addEventListener?n.addEventListener("load",i,!1):n.attachEvent?n.attachEvent("onload",i):n.onload=i,s()||(e.debug('DOM isn\'t ready. Subscribing to "onreadystatechange" event'),document.onreadystatechange=function(e){return function(){var r;return"function"==typeof e&&(r=e.apply(this,arguments)),s.apply(this,arguments),r}}(document.onreadystatechange))},createScript:function(e,r,t,n,s){var i,o,a=null,u=!1;if("function"==typeof t?(o=n,i=t,t=void 0):(i=n,o=s),e&&e.document&&e.document.body){if(a=e.document.createElement("script"),"object"==typeof t)for(var d in t)t.hasOwnProperty(d)&&null!=t[d]&&a.setAttribute("data-"+d,t[d]);switch(typeof r){case"string":if(r)a.src=r;else if("function"==typeof o)return void o(!1,e);break;case"object":case"undefined":return void("function"==typeof o&&o(!1,e))}"function"==typeof i&&(a.onload=a.onerror=a.onreadystatechange=function(r){u||(u=!0,a.onload=a.onerror=a.onreadystatechange=null,"load"===r.type||"loaded"===this.readyState||"complete"===this.readyState?i(a,e):"function"!=typeof o||"error"!==r.type&&"error"!==this.readyState||o(a,e))}),e.document.getElementsByTagName("head")[0].appendChild(a)}},createLoader:function(s){var i=function(s,i){var o,a=this.options.patch,u=function(r,t){t.enable(window,i,r),e.debug('Patch for module "'+t.name+'" applied correctly')},d=r.bind(function(){e.debug("Executing module callback"),this.options.success.call(this.api,this.api.require,this.api.define)},this),l=function(r){for(var t=0,n=a.length;n>t;t++)if("string"==typeof a[t]&&r.name===a[t]){a[t]=r,e.debug('Patch "'+r.name+'" is resolved.');break}--c||d()},c=0;if(this.api.require=this.sandbox.sandboxApi.require=i.require,this.api.define=this.sandbox.sandboxApi.define=i.define,this.api.status=this.sandbox.sandboxApi.status=0,this.options.debug&&(this.api.sandboxManager=this),"function"!=typeof this.api.require||"function"!=typeof this.api.define)return t.reset(),this.api.status=this.sandbox.sandboxApi.status=2,this.options.error.call(this.api),void e.error("Can not gain access to require.js inside sandbox");this.api.require.config(this.options.requireConfig);for(var h=0,f=this.options.plugins.length;f>h;h++){var p=this.options.plugins[h],g=""+p.name,b=!1;g||(e.error("Registered plugin has no name"),b=!0),"function"!=typeof p.handler&&(e.error("Registered plugin handler is not a function"),b=!0),e.debug("Successfuly registered plugin with name: "+g),b||this.api.define(g,p.handler)}for(e.debug("Creating predefined modules"),this.api.define("sandbox",function(){return i}),e.debug('Creating "preprocess" plugin for sandbox require.js'),o=new n(i),this.api.define(o.name,o.handler),e.debug("Creating handler for amd modules load"),this.api.require.onResourceLoad=function(e,r){for(var t,n=e.defined[r.id],s=r.name,o=0,d=a.length;d>o;o++)t=a[o],t.name==s&&u(n||i[t.shimName],a[o])},e.debug("Checking for unresolved patches"),h=0,f=a.length;f>h;h++)if("string"==typeof a[h]){var v=["requirejs-sandbox","patches",a[h]].join("/");window.require.defined(v)?(e.debug('Patch "'+v+'" is resolved in parent page. Linking with patch list...'),a[h]=window.require(v)):(c++,e.debug('Patch "'+v+'" is unresolved. Resolving...'),window.require([v],l))}c||d()};this.createScript(s,this.requireUrl,{main:this.options.requireMain},r.bind(i,this),r.bind(function(){t.reset(),this.api.status=this.sandbox.sandboxApi.status=3,this.options.error.call(this.api),e.error("Can not load require.js into sandbox")},this)),e.debug("Creating loader inside specified target:",s)}},e.setLogLevel("debug"),e.setNamespace("requirejs-sandbox"),{_getSandboxInternalInterface:function(){return i.prototype},get:function(e){return s[e]},set:function(t,n){var o;return"string"==typeof t?(o=this.get(t),o&&o.status<=0?(e.warn("Sandbox with name: "+t+" already exist! Returning existed sandbox.",o),o):s[t]=new i(r.extend({},n,{name:t}))):void e.error("Sandbox name should be string")},destroy:function(r){var t=this.get(r);t?(t.destroy(),delete s[r]):e.warn('Sandbox with name: "'+r+'" was not found')}}}),define("requirejs-sandbox/helpers/patch",["requirejs-sandbox/logger/logger","requirejs-sandbox/helpers/utils"],function(e,r){var t={_options:{},name:"default",shimName:"default",enable:function(){e.warn("Method is not implemented")},disable:function(){e.warn("Method is not implemented")},setOptions:function(e){var t=function(e){this._options=r.extend({},this._options,e)};return t.prototype=this,new t(e)}};return{init:function(e){return r.defaults(e||{},t)}}}),define("requirejs-sandbox/helpers/processor/prefix",["requirejs-sandbox/logger/logger"],function(e){var r=/(^\s*|}\s*|\s*)([@*.#\w\d\s-:\[\]\(\)="']+)(,|{[^}]+})/g,t=/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g;return{prefix:function(n){var s=new RegExp(n+"\\s","g");return this._responseSourceCache[this.id]=this._responseSourceCache[this.id].replace(t,"").replace(r,"$1"+n+" $2$3").replace(new RegExp(n+"\\s(@(charset|document|font-face|import|keyframes|media|page|supports))","g"),"$1").replace(/url\([^)]+\)/g,function(e){return e.replace(s,"")}).replace(new RegExp("("+n+")\\s(html|body)","g"),"$1"),e.debug('[prefix] Executing result for selector "'+n+'": ',this._responseSourceCache[this.id]),this}}});